// Auto-generated by UVM-AI
`timescale 1ns/1ps

module {{ top_module_name }};

  import uvm_pkg::*;
  `include "uvm_macros.svh"
  import {{ package_name }}::*;

  // Clock and reset
  logic clk;
  logic {{ reset_name }};

  // Clock generation
  initial begin
    clk = 0;
    forever #{{ (clock_period_ns / 2)|round(1) }} clk = ~clk;
  end

  // Reset generation
  initial begin
    {{ reset_name }} = {{ '0' if reset_active_low else '1' }};
    #{{ reset_duration_ns }};
    {{ reset_name }} = {{ '1' if reset_active_low else '0' }};
  end

  {% for intf in interfaces %}
  // {{ intf.name }} interface
  {{ intf.type }} {{ intf.name }}_if (.clk(clk), .{{ reset_name }}({{ reset_name }}));
  {% endfor %}

  // DUT instantiation
  {{ dut_module_name }} {% if dut_parameters %}#(
    {% for p in dut_parameters %}
    .{{ p.name }}({{ p.value }}){{ ',' if not loop.last else '' }}
    {% endfor %}
  ) {% endif %}u_dut (
    .clk(clk),
    .{{ reset_name }}({{ reset_name }}){{ ',' if port_connections else '' }}
    {% for conn in port_connections %}
    .{{ conn.port }}({{ conn.net }}){{ ',' if not loop.last else '' }}
    {% endfor %}
  );

  // UVM configuration and test start
  initial begin
    {% for intf in interfaces %}
    uvm_config_db#(virtual {{ intf.type }})::set(null, "*", "{{ intf.config_name }}", {{ intf.name }}_if);
    {% endfor %}
    run_test();
  end

  // Timeout watchdog
  initial begin
    #{{ simulation_timeout_ns }};
    `uvm_fatal("TIMEOUT", "Simulation timed out")
  end

endmodule
